<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <link rel="stylesheet" href="https://unpkg.com/xterm@5.3.0/css/xterm.css">
    <script src="https://unpkg.com/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://unpkg.com/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://unpkg.com/xterm-addon-attach@0.9.0/lib/xterm-addon-attach.js"></script>
  </head>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: black;
    }
    #terminal {
      width: 100vw;
      height: 100vh;
    }
  </style>
  <body>
    <div id="terminal"></div>
  </body>
</html>

<script>
  function sendResize(containerId, rows, cols) {
    fetch(`https://python-abc.xyz/linux/ws/containers/${containerId}/resize?h=${rows}&w=${cols}`, {
      method: "POST"
    });
  }
  const filename = window.location.pathname.split('/').pop()
  document.title = `ç»ˆç«¯ - ${filename}`;

  const containerId = `linux-${filename}`
  var term = new Terminal()
  term.options = {
      cursorStyle: 'underline',
      cursorBlink: true,
    }
  var fitAddon = new FitAddon.FitAddon()
  //var socket = new WebSocket(`ws://localhost:2375/containers/${containerId}/attach/ws?logs=0&stream=1&stdin=1&stdout=1&stderr=1`)
  var socket = new WebSocket(`wss://python-abc.xyz/linux/ws/containers/${containerId}/attach/ws?logs=0&stream=1&stdin=1&stdout=1&stderr=1`)
  var attachAddon = new AttachAddon.AttachAddon(socket)

  term.loadAddon(attachAddon)
  term.loadAddon(fitAddon)
  term.open(document.getElementById('terminal'))

  fitAddon.fit();  // åˆå§‹å¡«å……
  term.focus()

  socket.onopen = () => { 
    sendResize(containerId, term.rows, term.cols);
    socket.send('\n') 
  } // å½“è¿žæŽ¥å»ºç«‹æ—¶å‘ç»ˆç«¯å‘é€ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä¸è¿™ä¹ˆåšçš„è¯æœ€åˆç»ˆç«¯æ˜¯æ²¡æœ‰å†…å®¹çš„ï¼Œè¾“å…¥æ¢è¡Œç¬¦å¯è®©ç»ˆç«¯æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å·¥ä½œè·¯å¾„

  // å¯é€‰ï¼šè‡ªåŠ¨è°ƒæ•´å¤§å°
  window.addEventListener('resize', () => {
    fitAddon.fit();
    sendResize(containerId, term.rows, term.cols);
  });
  // ç¤ºä¾‹è¾“å‡º
  term.writeln(`ðŸš€ðŸš€ðŸš€ ${filename}ðŸš€ðŸš€ðŸš€`);
</script>

